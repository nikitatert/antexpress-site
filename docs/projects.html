<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Проекты — АНТэкспресс</title>
  <meta name="description" content="Проекты и кейсы компании АНТэкспресс." />
  <link rel="icon" href="./logo.png" type="image/png" />
  <link rel="stylesheet" href="./style.css" />
  <style>
    /* Map block */
    .map-wrap{margin-top:28px}
    #ru-map{
      height:520px; width:100%;
      border:1px solid var(--border);
      border-radius:16px; overflow:hidden;
      background:#eef3f0; /* ocean */
      position:relative;
    }
    .tip{
      position:absolute; pointer-events:none; z-index:10;
      background:#111; color:#fff; font-size:12px; line-height:1.3;
      padding:6px 8px; border-radius:8px; opacity:0; transform:translate(-50%,-120%);
      white-space:nowrap;
    }
    .ru-land{fill:#e5ebe8; stroke:none}              /* Russia polygon */
    .dot{fill:#0f6d2f; stroke:#fff; stroke-width:2px; cursor:pointer; transition:transform .12s}
    .dot:hover{transform:scale(1.1)}
    @media (max-width:640px){ #ru-map{height:400px} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <a class="logo" href="./index.html"><img src="./logo.png" alt="АНТэкспресс" width="200" height="58"/></a>
      <nav>
        <a href="./about.html">О компании</a>
        <a href="./projects.html">Проекты</a>
        <a href="./contacts.html">Контакты</a>
      </nav>
    </header>

    <main>
      <section class="hero section">
        <h1>Проекты и кейсы</h1>
        <p>Выдержка из направлений, где мы работаем как единый подрядчик по снабжению и логистике.</p>
      </section>

      <section class="section">
        <div class="list">
          <a class="card" href="./project-nikolo-dol.html"><h3>Николо-Дол</h3></a>
          <a class="card" href="./project-skandinaviya.html"><h3>Скандинавия</h3></a>
          <a class="card" href="./project-sakhalin.html"><h3>Сахалин</h3></a>
          <a class="card" href="./project-baikal.html"><h3>Байкал</h3></a>
        </div>
      </section>

      <!-- География проектов -->
      <section class="section">
        <h2>География проектов</h2>
        <p>Точки присутствия и ключевые площадки поставок.</p>
        <div class="map-wrap">
          <div id="ru-map"></div>
          <div class="tip" id="map-tip"></div>
        </div>
      </section>
    </main>

    <footer>
      <div>© <span id="y"></span> ООО «АНТэкспресс». Все права защищены.</div>
      <div><a href="./privacy.html" style="color:var(--muted);">Политика конфиденциальности</a></div>
    </footer>
  </div>

  <script>document.getElementById('y').textContent=new Date().getFullYear()</script>
  <script>
    document.querySelectorAll('nav a').forEach(a=>{
      if(a.href===window.location.href){a.classList.add('active')}
    });
  </script>

  <!-- D3 + TopoJSON -->
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script src="https://cdn.jsdelivr.net/npm/topojson-client@3"></script>
  <script>
    (function(){
      const el = document.getElementById('ru-map');
      const tip = document.getElementById('map-tip');

      // 5 locations (lat, lon) + links
      const points = [
        {name:'МО, Коммунарка — ЖК «Скандинавия Юг», м. «Потапово»', lat:55.536, lon:37.541, link:'./project-skandinaviya.html'},
        {name:'Южно-Сахалинск — СТК «Горный воздух»',               lat:46.957, lon:142.736, link:'./project-sakhalin.html'},
        {name:'Калужская обл. — на месте усадьбы Гурьевых XVIII века', lat:54.5144, lon:36.2550, link:'./project-nikolo-dol.html'},
        {name:'Респ. Бурятия, с. Турка — ОЭЗ «Байкальская гавань»',  lat:53.780, lon:108.261, link:'./project-baikal.html'},
        {name:'Санкт-Петербург, ул. Новая, д. 51, к. 79, стр. 1 (10 мин от «Лахта Центра»)', lat:60.010, lon:30.260, link:'./project-skandinaviya.html'}
      ];

      async function draw(){
        el.innerHTML='';
        const w = el.clientWidth, h = el.clientHeight;
        const svg = d3.select(el).append('svg')
          .attr('width', w).attr('height', h)
          .attr('viewBox', `0 0 ${w} ${h}`);

        const g = svg.append('g');

        // Load world countries, then filter Russia only (id 643)
        const world = await fetch('https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json').then(r=>r.json());
        const countries = topojson.feature(world, world.objects.countries);
        const russia = { type:'FeatureCollection',
          features: countries.features.filter(f => f.id === 643)  // 643 = Russia
        };

        // Fit the projection to Russia polygon only
        const projection = d3.geoMercator().fitSize([w,h], russia);
        const path = d3.geoPath(projection);

        // Draw Russia land (no other countries)
        g.append('path')
          .datum(russia)
          .attr('class','ru-land')
          .attr('d', path);

        // Dots
        g.selectAll('.dot')
          .data(points)
          .enter()
          .append('circle')
          .attr('class','dot')
          .attr('r', 5)
          .attr('cx', d=>projection([d.lon, d.lat])[0])
          .attr('cy', d=>projection([d.lon, d.lat])[1])
          .on('mouseenter', function(e,d){
            tip.textContent = d.name;
            tip.style.opacity = 1;
          })
          .on('mousemove', function(e){
            const rect = el.getBoundingClientRect();
            tip.style.left = (e.clientX - rect.left) + 'px';
            tip.style.top  = (e.clientY - rect.top ) + 'px';
          })
          .on('mouseleave', ()=> tip.style.opacity = 0)
          .on('click', (e,d)=>{ if(d.link) window.location.href = d.link; });

        // Optional zoom/pan within Russia
        const zoom = d3.zoom().scaleExtent([1, 8]).on('zoom', (ev)=>{ g.attr('transform', ev.transform); });
        svg.call(zoom);
      }

      draw();
      window.addEventListener('resize', draw);
    })();
  </script>
</body>
</html>
